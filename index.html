<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Teilungsverhältnisse – Aufteilen im Verhältnis (eine Aufgabe pro Seite)</title>

<style>
  * { box-sizing:border-box; font-family: system-ui, -apple-system, Segoe UI, sans-serif; }
  body { margin:0; background:#f4f4f4; display:flex; justify-content:center; }
  .app{
    background:#fff; max-width: 940px; width:100%;
    margin:12px; padding:12px; border-radius:10px;
    box-shadow:0 2px 8px rgba(0,0,0,.08);
  }
  h1 { margin: 6px 0 10px; text-align:center; font-size:18px; }

  .top { display:flex; justify-content:flex-end; align-items:center; gap:10px; flex-wrap:wrap; }
  .meta { font-size:12px; color:#555; }

  .card { margin-top:10px; border:1px solid #e5e5e5; border-radius:12px; padding:12px; background:#fff; }
  .cat { font-size:12px; font-weight:900; color:#444; margin-bottom:6px; }
  .title { font-weight:900; font-size:16px; margin-bottom:8px; }
  .text { font-size:14px; color:#222; line-height:1.35; }
  .text b { font-weight:900; }

  .prompt { margin-top:10px; font-weight:900; font-size:14px; color:#222; }

  .help{
    margin-top:10px; padding:10px;
    background:#fafafa; border:1px solid #eee; border-radius:12px;
    font-size:13px; color:#333;
    display:none;
  }
  .help b { font-weight:900; }

  .answers { display:grid; gap:8px; margin-top:10px; }
  .answer{
    border:1px solid #ccc; border-radius:12px; padding:10px;
    background:#fafafa; cursor:pointer; font-size:14px;
  }
  .answer:hover { background:#f0f0f0; }
  .answer.disabled { pointer-events:none; opacity:.95; }
  .answer.correct { background:#d4edda; border-color:#28a745; }
  .answer.wrong { background:#f8d7da; border-color:#dc3545; }

  .feedback { margin-top:10px; font-weight:900; min-height:22px; }
  .controls { margin-top:12px; display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap; }
  .btn{
    padding:8px 12px; border:none; border-radius:12px;
    background:#007bff; color:#fff; cursor:pointer; font-size:13px;
  }
  .btn:hover { background:#0062cc; }
  .btn.secondary { background:#222; }
  .btn.secondary:hover { background:#000; }
  .btn:disabled { opacity:.5; cursor:not-allowed; }

  /* ===== Visual: Balkenmodell ===== */
  .visualRow { margin-top:12px; display:flex; gap:14px; align-items:flex-start; flex-wrap:wrap; }
  .vizCard{
    flex:1 1 360px;
    border:1px solid #e5e5e5; border-radius:12px; padding:10px;
    background:#fcfcfc;
  }
  .vizTitle{ font-weight:900; margin-bottom:8px; font-size:13px; color:#222; }
  .bar{
    width:100%; height:52px;
    border:2px solid #333; border-radius:12px;
    overflow:hidden; display:flex;
    background:#fff;
  }
  .part{
    height:100%;
    border-right:1px solid rgba(0,0,0,.25);
    display:flex; align-items:center; justify-content:center;
    font-weight:900; font-size:12px; color:#222;
    user-select:none;
  }
  .part:last-child{ border-right:none; }
  .legend{ margin-top:8px; font-size:12px; color:#444; line-height:1.25; }
  .pill{
    display:inline-block; padding:2px 8px; border-radius:999px;
    border:1px solid #ddd; background:#fff; font-weight:900;
    margin-right:6px;
  }

  /* ===== Sort (Drag&Drop) ===== */
  .sortWrap { margin-top:10px; display:flex; realize:wrap; gap:12px; flex-wrap:wrap; }
  .bank, .target{
    flex:1 1 320px;
    border:2px dashed #aaa; border-radius:12px; padding:10px; background:#fcfcfc;
    min-height:130px;
  }
  .zoneTitle { font-weight:900; margin-bottom:8px; }
  .hint { font-size:12px; color:#555; margin-top:6px; }
  .sortItem{
    border:1px solid #ccc; border-radius:12px; padding:10px; background:#fafafa;
    margin-bottom:8px; cursor:grab; user-select:none;
  }
  .ok { color:#28a745; font-weight:900; }
  .bad { color:#dc3545; font-weight:900; }
</style>
</head>

<body>
<div class="app">
  <h1>Teilungsverhältnisse – Aufteilen im Verhältnis</h1>

  <div class="top">
    <div class="meta" id="meta">0 / 0</div>
  </div>

  <div class="card">
    <div class="cat" id="cat"></div>
    <div class="title" id="title"></div>

    <div class="text" id="text"></div>

    <div id="visual" class="visualRow" style="display:none;"></div>

    <div class="prompt" id="prompt" style="display:none;"></div>

    <div id="answers" class="answers"></div>
    <div id="sortUI" style="display:none;"></div>

    <div class="help" id="help"></div>
    <div class="feedback" id="feedback"></div>

    <div class="controls">
      <button class="btn secondary" id="restartBtn">Neu starten</button>
      <button class="btn" id="nextBtn" disabled>Weiter</button>
    </div>
  </div>
</div>

<script>
/* =========================
   Helpers
========================= */
function shuffle(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}
function gcd(a,b){
  a=Math.abs(a); b=Math.abs(b);
  while(b){ const t=a%b; a=b; b=t; }
  return a || 1;
}
function simplifyRatio(a,b){
  const g=gcd(a,b);
  return [a/g, b/g];
}
function splitTotal(total, a, b){
  const sum = a + b;
  const one = total / sum;
  return {A: a*one, B: b*one, onePart: one, sumParts: sum};
}
function niceInt(x){ return Number.isInteger(x) ? String(x) : String(x); }

/* =========================
   Visual: Balkenmodell
========================= */
function renderBarModel(container, total, a, b, nameA="Anna", nameB="Ben", unit=""){
  const s = simplifyRatio(a,b);
  const aa = s[0], bb = s[1];
  const sum = aa + bb;

  // Balken in "sum" Teile
  const parts = [];
  for(let i=0;i<sum;i++){
    const isA = i < aa;
    parts.push({label: isA ? nameA[0] : nameB[0]});
  }

  const calc = splitTotal(total, aa, bb);

  // Build HTML
  container.innerHTML = `
    <div class="vizCard">
      <div class="vizTitle">Balkenmodell: Verhältnis ${aa}:${bb}</div>
      <div class="bar">
        ${parts.map(p => `
          <div class="part" style="width:${(100/sum).toFixed(3)}%">${p.label}</div>
        `).join("")}
      </div>
      <div class="legend">
        <span class="pill">${nameA} = ${aa} Teile</span>
        <span class="pill">${nameB} = ${bb} Teile</span><br>
        Insgesamt: <b>${sum}</b> Teile → <b>1 Teil = ${niceInt(calc.onePart)}${unit}</b><br>
        ⇒ ${nameA}: <b>${niceInt(calc.A)}${unit}</b>, ${nameB}: <b>${niceInt(calc.B)}${unit}</b>
      </div>
    </div>
  `;
}

/* =========================
   Steps
========================= */
const steps = [
  {
    type:"intro",
    cat:"Einführung",
    title:"Was heißt „im Verhältnis a:b aufteilen“?",
    text: `
      <p><b>Teilungsverhältnis</b> bedeutet: Ein Ganzes wird <b>aufgeteilt</b>.</p>
      <p>Wenn wir im Verhältnis <b>2:3</b> aufteilen, heißt das:</p>
      <p>Das Ganze besteht aus <b>2 + 3 = 5 gleich großen Teilen</b>.</p>
      <p><b>Merksatz:</b><br>
      Verhältnis <b>a:b</b> → insgesamt <b>a+b Teile</b> →<br>
      <b>1 Teil = Ganzes ÷ (a+b)</b></p>
    `
  },

  {
    type:"mc",
    cat:"Level 1 – Teile zählen",
    title:"Aufgabe 1",
    text: `
      <p>Ein Kuchen wird im Verhältnis <b>2:3</b> aufgeteilt.</p>
      <p><b>Wie viele Teile</b> hat der ganze Kuchen zusammen?</p>
    `,
    prompt:"Welche Antwort stimmt?",
    showVisual:true,
    visual:{ total: 5, a:2, b:3, nameA:"A", nameB:"B", unit:"" }, // nur fürs Bild; total wird hier nicht als Menge interpretiert
    answers:[
      {t:"5 Teile", ok:true},
      {t:"6 Teile", ok:false},
      {t:"2 Teile", ok:false},
      {t:"3 Teile", ok:false}
    ],
    helpText:`Bei <b>2:3</b> zählt man die Teile: <b>2 + 3 = 5</b>.`
  },

  {
    type:"mc",
    cat:"Level 1 – Aufteilen mit einfacher Zahl",
    title:"Aufgabe 2",
    text: `
      <p>Es gibt <b>30 Bonbons</b>.</p>
      <p>Sie werden im Verhältnis <b>2:3</b> aufgeteilt (Anna : Ben).</p>
      <p>Wie viele Bonbons bekommt <b>Anna</b>?</p>
    `,
    prompt:"Wähle die richtige Antwort.",
    showVisual:true,
    visual:{ total:30, a:2, b:3, nameA:"Anna", nameB:"Ben", unit:"" },
    answers:[
      {t:"12", ok:true},
      {t:"18", ok:false},
      {t:"10", ok:false},
      {t:"15", ok:false}
    ],
    helpText:`2:3 → <b>5 Teile</b>. 30 ÷ 5 = <b>6</b> pro Teil. Anna hat 2 Teile → <b>12</b>.`
  },

  {
    type:"yesno",
    cat:"Level 1 – Plausibilitäts-Falle",
    title:"Aufgabe 3",
    text: `
      <p>48 € werden im Verhältnis <b>1:3</b> aufgeteilt (A : B).</p>
      <p>A bekommt 16 € und B bekommt 32 €.</p>
    `,
    prompt:"Stimmt das?",
    showVisual:true,
    visual:{ total:48, a:1, b:3, nameA:"A", nameB:"B", unit:"€" },
    correctYes:true,
    helpText:`1:3 → 4 Teile. 48 ÷ 4 = 12 € pro Teil. A: 12 €, B: 36 € wäre falsch – Moment! Hier ist die Vereinfachung wichtig: 48/4=12, also A=12 und B=36. Die Aussage 16/32 entspricht 1:2, nicht 1:3.`
  },

  {
    type:"mc",
    cat:"Level 2 – Verhältnis vereinfachen",
    title:"Aufgabe 4",
    text: `
      <p>60 Punkte werden im Verhältnis <b>4:6</b> aufgeteilt (Team Rot : Team Blau).</p>
      <p>Wie viele Punkte bekommt Team Rot?</p>
    `,
    prompt:"Wähle die richtige Antwort.",
    showVisual:true,
    visual:{ total:60, a:4, b:6, nameA:"Rot", nameB:"Blau", unit:"" },
    answers:[
      {t:"24", ok:true},
      {t:"40", ok:false},
      {t:"20", ok:false},
      {t:"30", ok:false}
    ],
    helpText:`4:6 kann man zu <b>2:3</b> kürzen. Insgesamt 5 Teile. 60 ÷ 5 = 12. Rot: 2 Teile → 24.`
  },

  {
    type:"mc",
    cat:"Level 2 – Sprache → Verhältnis",
    title:"Aufgabe 5",
    text: `
      <p>„Ben bekommt <b>doppelt so viel</b> wie Anna.“</p>
      <p>Welches Verhältnis passt (Anna : Ben)?</p>
    `,
    prompt:"Wähle die richtige Antwort.",
    showVisual:false,
    answers:[
      {t:"1:2", ok:true},
      {t:"2:1", ok:false},
      {t:"2:3", ok:false},
      {t:"1:3", ok:false}
    ],
    helpText:`„Ben doppelt so viel wie Anna“ heißt: Anna 1 Teil, Ben 2 Teile → <b>1:2</b>.`
  },

  {
    type:"mc",
    cat:"Level 3 – Strecken teilen",
    title:"Aufgabe 6",
    text: `
      <p>Eine Strecke ist <b>56 cm</b> lang.</p>
      <p>Sie wird im Verhältnis <b>5:2</b> geteilt (Teil A : Teil B).</p>
      <p>Wie lang ist <b>Teil B</b>?</p>
    `,
    prompt:"Wähle die richtige Antwort.",
    showVisual:true,
    visual:{ total:56, a:5, b:2, nameA:"Teil A", nameB:"Teil B", unit:" cm" },
    answers:[
      {t:"16 cm", ok:true},
      {t:"40 cm", ok:false},
      {t:"14 cm", ok:false},
      {t:"20 cm", ok:false}
    ],
    helpText:`5:2 → 7 Teile. 56 ÷ 7 = 8 cm pro Teil. Teil B: 2 Teile → 16 cm.`
  },

  {
    type:"sort",
    cat:"Sortieren",
    title:"Aufgabe 7",
    text: `
      <p><b>Ordne von „A bekommt am meisten“ nach „A bekommt am wenigsten“.</b></p>
      <p>Ziehe alle Karten in „Meine Reihenfolge“.</p>
    `,
    prompt:"Oben = A-Anteil am größten. Unten = A-Anteil am kleinsten.",
    showVisual:false,
    sortItems:[
      {id:"r1", text:"A:B = 3:1", a:3, b:1},
      {id:"r2", text:"A:B = 2:3", a:2, b:3},
      {id:"r3", text:"A:B = 1:1", a:1, b:1},
      {id:"r4", text:"A:B = 1:4", a:1, b:4},
    ],
    helpText:`Vergleiche den Anteil von A: <b>a/(a+b)</b>. Größerer Anteil → weiter nach oben.`
  }
];

/* =========================
   Fix: Aufgabe 3 (Yes/No) – Helptext war zu „nett“
   -> Wir korrigieren: 16/32 ist NICHT 1:3
========================= */
steps[3].helpText = `1:3 → 4 Teile. 48 ÷ 4 = <b>12 €</b> pro Teil. Also A = 12 €, B = 36 €. <br>
Die Angabe 16 € und 32 € ist Verhältnis <b>1:2</b> (weil 16:32 kürzt sich zu 1:2).`;

/* =========================
   UI state
========================= */
let stepIndex = 0;
let answered = false;

const metaEl = document.getElementById("meta");
const catEl = document.getElementById("cat");
const titleEl = document.getElementById("title");
const textEl = document.getElementById("text");
const promptEl = document.getElementById("prompt");
const helpEl = document.getElementById("help");
const answersEl = document.getElementById("answers");
const feedbackEl = document.getElementById("feedback");
const nextBtn = document.getElementById("nextBtn");
const restartBtn = document.getElementById("restartBtn");
const visualEl = document.getElementById("visual");
const sortUI = document.getElementById("sortUI");

function setMeta(){ metaEl.textContent = `${stepIndex + 1} / ${steps.length}`; }

function clearScreen(){
  answersEl.innerHTML = "";
  feedbackEl.textContent = "";
  answered = false;
  nextBtn.disabled = true;

  visualEl.style.display = "none";
  visualEl.innerHTML = "";

  sortUI.style.display = "none";
  sortUI.innerHTML = "";

  promptEl.style.display = "none";
  promptEl.textContent = "";

  helpEl.style.display = "none";
  helpEl.innerHTML = "";
}

function showHelpIfExists(s){
  if(!s.helpText) return;
  helpEl.innerHTML = `<b>${s.helpText}</b>`;
  helpEl.style.display = "block";
}

function renderStep(){
  clearScreen();
  setMeta();

  const s = steps[stepIndex];
  catEl.textContent = s.cat || "";
  titleEl.textContent = s.title || "";
  textEl.innerHTML = s.text || "";

  if(s.prompt){
    promptEl.style.display = "block";
    promptEl.textContent = s.prompt;
  }

  if(s.type === "intro"){
    nextBtn.disabled = false;
    return;
  }

  if(s.showVisual && s.visual){
    visualEl.style.display = "flex";
    const v = s.visual;
    // Bar model expects total + ratio
    // For Aufgabe 1 visual: total isn't a "real total", but it's fine.
    renderBarModel(visualEl, v.total, v.a, v.b, v.nameA, v.nameB, v.unit || "");
  }

  if(s.type === "mc"){
    renderMC(s);
  } else if(s.type === "yesno"){
    renderYesNo(s);
  } else if(s.type === "sort"){
    renderSort(s);
  }
}

function renderMC(s){
  const order = shuffle(s.answers.map((_,i)=>i));
  order.forEach((idx) => {
    const a = s.answers[idx];
    const btn = document.createElement("div");
    btn.className = "answer";
    btn.textContent = a.t;

    btn.onclick = () => {
      if(answered) return;
      answered = true;
      [...answersEl.children].forEach(el => el.classList.add("disabled"));

      if(a.ok){
        btn.classList.add("correct");
        feedbackEl.textContent = "Richtig.";
      } else {
        btn.classList.add("wrong");
        feedbackEl.textContent = "Falsch.";
        [...answersEl.children].forEach((el) => {
          const txt = el.textContent;
          const found = s.answers.find(x => x.t === txt);
          if(found && found.ok) el.classList.add("correct");
        });
      }
      showHelpIfExists(s);
      nextBtn.disabled = false;
    };

    answersEl.appendChild(btn);
  });
}

function renderYesNo(s){
  const opts = shuffle([
    {t:"Ja", ok: s.correctYes === true},
    {t:"Nein", ok: s.correctYes === false}
  ]);

  opts.forEach(o => {
    const btn = document.createElement("div");
    btn.className = "answer";
    btn.textContent = o.t;

    btn.onclick = () => {
      if(answered) return;
      answered = true;
      [...answersEl.children].forEach(el => el.classList.add("disabled"));

      if(o.ok){
        btn.classList.add("correct");
        feedbackEl.textContent = "Richtig.";
      } else {
        btn.classList.add("wrong");
        feedbackEl.textContent = "Falsch.";
        [...answersEl.children].forEach(el => {
          if((el.textContent==="Ja" && s.correctYes) || (el.textContent==="Nein" && !s.correctYes)){
            el.classList.add("correct");
          }
        });
      }
      showHelpIfExists(s);
      nextBtn.disabled = false;
    };

    answersEl.appendChild(btn);
  });
}

/* =========================
   Sort UI (Drag&Drop)
========================= */
let dragEl = null;

function enableDnD(container){
  container.addEventListener("dragstart", (e) => {
    const item = e.target.closest(".sortItem");
    if(!item) return;
    dragEl = item;
    e.dataTransfer.effectAllowed = "move";
  });

  container.addEventListener("dragover", (e) => {
    e.preventDefault();
    const zone = e.target.closest(".bank, .target");
    if(!zone || !dragEl) return;

    const overItem = e.target.closest(".sortItem");
    if(overItem && overItem.parentElement === zone && overItem !== dragEl){
      const rect = overItem.getBoundingClientRect();
      const after = (e.clientY - rect.top) > rect.height/2;
      if(after) overItem.after(dragEl);
      else overItem.before(dragEl);
    } else if(!overItem){
      zone.appendChild(dragEl);
    }
  });

  container.addEventListener("drop", (e) => { e.preventDefault(); dragEl = null; });
  container.addEventListener("dragend", () => dragEl = null);
}

function aShare(a,b){ return a/(a+b); }

function renderSort(s){
  sortUI.style.display = "block";

  const wrap = document.createElement("div");
  wrap.className = "sortWrap";

  const bank = document.createElement("div");
  bank.className = "bank";
  bank.innerHTML = `<div class="zoneTitle">Karten</div><div class="hint">Ziehe alle Karten in „Meine Reihenfolge“.</div>`;

  const target = document.createElement("div");
  target.className = "target";
  target.innerHTML = `<div class="zoneTitle">Meine Reihenfolge</div><div class="hint">Oben = A-Anteil am größten.</div>`;

  const items = shuffle(s.sortItems.slice());
  items.forEach(it => {
    const div = document.createElement("div");
    div.className = "sortItem";
    div.draggable = true;
    div.textContent = it.text;
    div.dataset.a = it.a;
    div.dataset.b = it.b;
    bank.appendChild(div);
  });

  wrap.appendChild(bank);
  wrap.appendChild(target);

  const checkRow = document.createElement("div");
  checkRow.style.marginTop = "10px";
  checkRow.style.display = "flex";
  checkRow.style.gap = "8px";
  checkRow.style.flexWrap = "wrap";
  checkRow.style.alignItems = "center";

  const checkBtn = document.createElement("button");
  checkBtn.className = "btn";
  checkBtn.textContent = "Prüfen";

  const result = document.createElement("div");
  result.style.fontWeight = "900";

  checkBtn.onclick = () => {
    const targetItems = [...target.querySelectorAll(".sortItem")];
    if(targetItems.length !== s.sortItems.length){
      result.className = "bad";
      result.textContent = "Noch nicht. Ziehe zuerst alle Karten in „Meine Reihenfolge“.";
      nextBtn.disabled = true;
      return;
    }

    const correct = s.sortItems
      .slice()
      .sort((x,y) => aShare(y.a,y.b) - aShare(x.a,x.b))
      .map(x => `${x.a}:${x.b}`);

    const current = targetItems.map(el => `${el.dataset.a}:${el.dataset.b}`);

    const ok = correct.join("|") === current.join("|");
    if(ok){
      result.className = "ok";
      result.textContent = "✅ Richtig geordnet.";
      nextBtn.disabled = false;
    } else {
      result.className = "bad";
      result.textContent = "❌ Noch nicht. Tipp: A-Anteil = a/(a+b).";
      nextBtn.disabled = true;
    }

    showHelpIfExists(s);
  };

  checkRow.appendChild(checkBtn);
  checkRow.appendChild(result);

  sortUI.appendChild(wrap);
  sortUI.appendChild(checkRow);

  enableDnD(sortUI);
}

/* =========================
   Navigation
========================= */
nextBtn.onclick = () => {
  stepIndex++;
  if(stepIndex >= steps.length) stepIndex = 0;
  renderStep();
};
restartBtn.onclick = () => {
  stepIndex = 0;
  renderStep();
};

renderStep();
</script>
</body>
</html>
